generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String        @id @default(cuid())
  email            String        @unique
  name             String
  role             Role          @default(USER)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  activityLogs     ActivityLog[]
  createdQuestions Question[]
  quizAttempts     QuizAttempt[]
  createdQuizzes   Quiz[]

  @@map("users")
}

model Question {
  id            String         @id @default(cuid())
  question      String
  option1       String
  option2       String
  option3       String
  option4       String
  correctAnswer Int
  difficulty    Difficulty     @default(MEDIUM)
  explanation   String?
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  createdById   String
  answers       Answer[]
  createdBy     User           @relation(fields: [createdById], references: [id])
  quizQuestions QuizQuestion[]

  @@map("questions")
}

model Quiz {
  id            String         @id @default(cuid())
  title         String
  description   String?
  timeLimit     Int            @default(30)
  isPublic      Boolean        @default(true)
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  createdById   String
  category      String?
  difficulty    Difficulty?    @default(MEDIUM)
  imageUrl      String?
  quizAttempts  QuizAttempt[]
  quizQuestions QuizQuestion[]
  createdBy     User           @relation(fields: [createdById], references: [id])

  @@map("quizzes")
}

model QuizQuestion {
  id         String   @id @default(cuid())
  order      Int
  points     Int      @default(1)
  quizId     String
  questionId String
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  quiz       Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@unique([quizId, questionId])
  @@unique([quizId, order])
  @@map("quiz_questions")
}

model QuizAttempt {
  id          String        @id @default(cuid())
  score       Int           @default(0)
  totalPoints Int
  timeSpent   Int?
  status      AttemptStatus @default(IN_PROGRESS)
  startedAt   DateTime      @default(now())
  completedAt DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  userId      String
  quizId      String
  answers     Answer[]
  quiz        Quiz          @relation(fields: [quizId], references: [id], onDelete: Cascade)
  user        User          @relation(fields: [userId], references: [id])

  @@map("quiz_attempts")
}

model Answer {
  id             String      @id @default(cuid())
  selectedAnswer Int?
  isCorrect      Boolean?
  timeSpent      Int?
  createdAt      DateTime    @default(now())
  attemptId      String
  questionId     String
  attempt        QuizAttempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  question       Question    @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([attemptId, questionId])
  @@map("answers")
}

model ActivityLog {
  id        String       @id @default(cuid())
  type      ActivityType
  title     String
  metadata  String?
  createdAt DateTime     @default(now())
  userId    String
  user      User         @relation(fields: [userId], references: [id])

  @@map("activity_logs")
}

enum Role {
  USER
  ADMIN
  MODERATOR
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum AttemptStatus {
  IN_PROGRESS
  COMPLETED
  ABANDONED
}

enum ActivityType {
  QUIZ_CREATED
  QUIZ_DELETED
  QUIZ_UPDATED
  QUESTION_CREATED
  QUESTION_DELETED
  QUESTION_UPDATED
  QUIZ_ATTEMPTED
  USER_REGISTERED
  USER_UPDATED
  USER_DELETED
}
